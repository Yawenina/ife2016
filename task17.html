<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Task 17</title>
    <style>
        .aqi-chart-wrap{
            display: flex;
            justify-content: space-around;
            align-items:flex-end;
            border:2px solid #b2b2b2;
            box-shadow:5px 5px 5px #d3d3d3;
            border-radius:5px;
            margin:20px auto;
            position:relative;
            height:550px;
            width:1200px;
            text-align:center;
            /*overflow: hidden;*/
        }
        .aqi-chart-wrap div{
            margin-right:10px;
            flex:1;
        }
        .aqi-chart-wrap div:first-child{
            margin-left:10px;
        }
        .time{
            position:absolute;
            bottom:0px;
            left:10px;
        }
        .day{
            width:10px;
        }
        .week{
            width:50px;
        }
        .month{
            width:200px;
        }
        .title{
            display: none;
            width:120px;
            padding:5px;
            border:2px solid #b2b2b2;
            border-radius:5px;
            text-align: center;
            position: absolute;
            bottom:calc(100% + 10px);
            left:-70px;
            font-size:12px;
            z-index:1000;
            background: white;
            opacity: .75;
        }
        .time:hover .title{
            display: block;
        }
        .month:hover .title{
            left:30px;
        }
    </style>
</head>
<body>
    <fieldset id="form-gra-time">
        <legend>请选择日期粒度：</legend>
        <label>日<input name="gra-time" value="day" type="radio" checked="checked"></label>
        <label>周<input name="gra-time" value="week" type="radio"></label>
        <label>月<input name="gra-time" value="month" type="radio"></label>
    </fieldset>

    <fieldset>
        <legend>请选择查看的城市：</legend>
        <select id="city-select">
        </select>
    </fieldset>

    <div class="aqi-chart-wrap">

    </div>

    <script src="js/task17.js?x"></script>

    <!--<script>-->
        <!--/* 数据格式演示-->
         <!--var aqiSourceData = {-->
         <!--"北京": {-->
         <!--"2016-01-01": 10,-->
         <!--"2016-01-02": 10,-->
         <!--"2016-01-03": 10,-->
         <!--"2016-01-04": 10-->
         <!--}-->
         <!--};-->
         <!--*/-->

        <!--// 以下两个函数用于随机模拟生成测试数据-->
        <!--function getDateStr(dat) {-->
            <!--var y = dat.getFullYear();-->
            <!--var m = dat.getMonth() + 1;-->
            <!--m = m < 10 ? '0' + m : m;-->
            <!--var d = dat.getDate();-->
            <!--d = d < 10 ? '0' + d : d;-->
            <!--return y + '-' + m + '-' + d;-->
        <!--}-->
        <!--function randomBuildData(seed) {-->
            <!--var returnData = {};-->
            <!--var dat = new Date("2016-01-01");-->
            <!--var datStr = '';-->
            <!--for (var i = 1; i < 92; i++) {-->
                <!--datStr = getDateStr(dat);-->
                <!--returnData[datStr] = Math.ceil(Math.random() * seed);-->
                <!--dat.setDate(dat.getDate() + 1);-->
            <!--}-->
            <!--return returnData;-->
        <!--}-->

        <!--var aqiSourceData = {-->
            <!--"北京": randomBuildData(500),-->
            <!--"上海": randomBuildData(300),-->
            <!--"广州": randomBuildData(200),-->
            <!--"深圳": randomBuildData(100),-->
            <!--"成都": randomBuildData(300),-->
            <!--"西安": randomBuildData(500),-->
            <!--"福州": randomBuildData(100),-->
            <!--"厦门": randomBuildData(100),-->
            <!--"沈阳": randomBuildData(500)-->
        <!--};-->

        <!--// 用于渲染图表的数据-->
        <!--var chartData = {-->
            <!--0:"#FF7676",-->
            <!--1:"#F6F49D",-->
            <!--2:"#5DAE8B",-->
            <!--3:"#466C95",-->
            <!--4:"#FFB26B",-->
            <!--5:"#7899DC",-->
        <!--};-->

        <!--// 记录当前页面的表单选项-->
        <!--var pageState = {-->
            <!--nowSelectCity: "北京",-->
            <!--nowGraTime: "day"-->
        <!--}-->

        <!--/**-->
         <!--* 渲染图表-->
         <!--*/-->
        <!--function renderChart() {-->
            <!--var     city = aqiSourceData[pageState.nowSelectCity],-->
                    <!--chart = document.querySelector(".aqi-chart-wrap"),-->
                    <!--fragment = document.createDocumentFragment();-->

            <!--switch(pageState.nowGraTime){-->
                <!--//每日数据处理-->
                <!--case 'day':-->
                    <!--var left=10,i=0;-->
                    <!--for(key in city){-->
                        <!--var div = document.createElement("div");-->
                        <!--div.className = "day time";-->
                        <!--div.style.height = city[key] + "px";-->
                        <!--div.style.backgroundColor = chartData[i%4];-->
                        <!--div.style.left = left + "px";-->
                        <!--var title = document.createElement("div");-->
                        <!--title.className = "title";-->
                        <!--title.innerHTML = key +"<br>[空气质量指数]" + city[key];-->
                        <!--div.appendChild(title);-->
                        <!--fragment.appendChild(div);-->
                        <!--i++;left=13*i+10;-->
                    <!--}-->
                    <!--chart.innerHTML = "<h3>" +pageState.nowSelectCity +"市每日空气质量指数</h3>";-->
                    <!--chart.appendChild(fragment);-->
                    <!--break;-->

                <!--//每周数据处理-->
                <!--case 'week':-->
                    <!--var k=0;-->
                    <!--for(var i=1;i<4;i++){-->
                        <!--for(var j=1;j<6;j++){-->
                            <!--var arr = i+"月第" +j +"周",-->
                                <!--data = chartData[arr],-->
                                    <!--len = data.length;-->
                            <!--var h = Math.ceil(data.reduce(function(prev,cur){-->
                                        <!--return prev+cur;-->
                                    <!--})/len);-->
                            <!--var div = document.createElement("div");-->
                            <!--div.className = "week time";-->
                            <!--div.style.height = h + "px";-->
                            <!--div.style.backgroundColor = chartData[j%5];-->
                            <!--div.style.left = left + "px";-->
                            <!--var title = document.createElement("div");-->
                            <!--title.className = "title";-->
                            <!--title.innerHTML = arr +"<br>[空气质量指数]" + h;-->
                            <!--div.appendChild(title);-->
                            <!--fragment.appendChild(div);-->
                            <!--k++;left=80*k+10;-->
                        <!--}-->
                    <!--}-->
                    <!--chart.innerHTML = "<h3>" +pageState.nowSelectCity +"市每周空气质量指数</h3>";-->
                    <!--chart.appendChild(fragment);-->
                    <!--break;-->

                <!--//每月数据处理-->
                <!--case 'month':-->
                    <!--for(var i=1;i<4;i++){-->
                        <!--var arr = i+"月",-->
                                <!--data = chartData[arr],-->
                                <!--len = data.length;-->
                        <!--var h = Math.ceil(data.reduce(function(prev,cur){-->
                                    <!--return prev+cur;-->
                                <!--})/len);-->
                        <!--var div = document.createElement("div");-->
                        <!--left=150*i+200*(i-1);-->
                        <!--div.className = "month time";-->
                        <!--div.style.height = h + "px";-->
                        <!--div.style.backgroundColor = chartData[i%5];-->
                        <!--div.style.left = left + "px";-->
                        <!--var title = document.createElement("div");-->
                        <!--title.className = "title";-->
                        <!--title.innerHTML = arr +"<br>[空气质量指数]" + h;-->
                        <!--div.appendChild(title);-->
                        <!--fragment.appendChild(div);-->
                    <!--}-->

                    <!--chart.innerHTML = "<h3>" +pageState.nowSelectCity +"市每月空气质量指数</h3>";-->
                    <!--chart.appendChild(fragment);-->
                    <!--break;-->

            <!--}-->
        <!--}-->

        <!--/**-->
         <!--* 日、周、月的radio事件点击时的处理函数-->
         <!--*/-->
        <!--function graTimeChange() {-->
                <!--var time = document.querySelectorAll("[name='gra-time']");-->
                <!--for(var i=0;i<time.length;i++){-->
                    <!--if(time[i].checked){-->
                        <!--// 确定是否选项发生了变化-->
                        <!--if(time[i].value != pageState.nowGraTime){-->
                            <!--// 设置对应数据-->
                            <!--pageState.nowGraTime= time[i].value;-->
                            <!--// 调用图表渲染函数-->
                            <!--initAqiChartData();-->
                            <!--renderChart();-->
                        <!--}-->
                    <!--}-->
                <!--}-->
        <!--}-->

        <!--/**-->
         <!--* select发生变化时的处理函数-->
         <!--*/-->
        <!--function citySelectChange() {-->
            <!--var select = document.getElementById("city-select"),-->
                    <!--options = select.options;-->
            <!--// 确定是否选项发生了变化-->

            <!--// 设置对应数据-->

            <!--// 调用图表渲染函数-->
            <!--for(var i=0;i<options.length;i++){-->
                <!--if(options[i].selected){-->
                    <!--if(options[i].value != pageState.nowSelectCity){-->
                        <!--pageState.nowSelectCity = options[i].value;-->
                        <!--initAqiChartData();-->
                        <!--renderChart();-->
                    <!--}-->
                <!--}-->
            <!--}-->
        <!--}-->

        <!--/**-->
         <!--* 初始化日、周、月的radio事件，当点击时，调用函数graTimeChange-->
         <!--*/-->
        <!--function initGraTimeForm() {-->
            <!--var fieldTime = document.getElementById("form-gra-time");-->
            <!--fieldTime.addEventListener("click",graTimeChange,false);-->
        <!--}-->

        <!--/**-->
         <!--* 初始化城市Select下拉选择框中的选项-->
         <!--*/-->
        <!--function initCitySelector() {-->
            <!--// 读取aqiSourceData中的城市，然后设置id为city-select的下拉列表中的选项-->
            <!--var select = document.getElementById("city-select"),-->
                    <!--fragment = document.createDocumentFragment();-->
            <!--for(key in aqiSourceData){-->
                <!--var option = new Option(key,key);-->
                <!--fragment.appendChild(option);-->
            <!--}-->
            <!--select.appendChild(fragment);-->
            <!--// 给select设置事件，当选项发生变化时调用函数citySelectChange-->
            <!--select.addEventListener("change",citySelectChange,false);-->
        <!--}-->

        <!--/**-->
         <!--* 初始化图表需要的数据格式-->
         <!--*/-->
        <!--function initAqiChartData() {-->
            <!--// 将原始的源数据处理成图表需要的数据格式-->
            <!--// 处理好的数据存到 chartData 中-->

            <!--var city = aqiSourceData[pageState.nowSelectCity];-->
            <!--//将每项数据存入数组data-->
            <!--var data = [];-->
            <!--for(key in city){-->
                <!--data.push(city[key]);-->
            <!--}-->
            <!--chartData["data"] = data;-->
            <!--chartData["1月"] = data.slice(0,31);-->
            <!--chartData["2月"] = data.slice(31,60);-->
            <!--chartData["3月"] = data.slice(60);-->
            <!--chartData["1月第1周"] = chartData["1月"].slice(0,7);-->
            <!--chartData["1月第2周"] = chartData["1月"].slice(7,14);-->
            <!--chartData["1月第3周"] = chartData["1月"].slice(14,21);-->
            <!--chartData["1月第4周"] = chartData["1月"].slice(21,28);-->
            <!--chartData["1月第5周"] = chartData["1月"].slice(28,31);-->
            <!--chartData["2月第1周"] = chartData["2月"].slice(0,7);-->
            <!--chartData["2月第2周"] = chartData["2月"].slice(7,14);-->
            <!--chartData["2月第3周"] = chartData["2月"].slice(14,21);-->
            <!--chartData["2月第4周"] = chartData["2月"].slice(21,28);-->
            <!--chartData["2月第5周"] = chartData["2月"].slice(28,30);-->
            <!--chartData["3月第1周"] = chartData["3月"].slice(0,7);-->
            <!--chartData["3月第2周"] = chartData["3月"].slice(7,14);-->
            <!--chartData["3月第3周"] = chartData["3月"].slice(14,21);-->
            <!--chartData["3月第4周"] = chartData["3月"].slice(21,28);-->
            <!--chartData["3月第5周"] = chartData["3月"].slice(28,31);-->

        <!--}-->

        <!--/**-->
         <!--* 初始化函数-->
         <!--*/-->
        <!--function init() {-->
            <!--initGraTimeForm();-->
            <!--initCitySelector();-->
            <!--initAqiChartData();-->
            <!--renderChart();-->
        <!--}-->

        <!--init();-->
    <!--&lt;!&ndash;</script>-->
</body>
</html>